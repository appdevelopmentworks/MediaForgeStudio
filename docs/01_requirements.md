# 📋 MediaForge Studio - 要求定義書 v1.0

---

## 📌 プロジェクト基本情報

**プロジェクト名**: MediaForge Studio  
**バージョン**: v1.0.0  
**目的**: YouTube動画の加工・吹き替え・統合を行う教育向けメディア処理ツール  
**対象ユーザー**: 教育者、コンテンツクリエイター、研究者

---

## 🎯 主要ユースケース

### **ユースケース1: 複数YouTube動画の統合**
**シナリオ**: 教育者が複数の短い講義動画を1つの長編動画にまとめる

**処理フロー**:
1. 複数のYouTube URLを入力
2. 各動画をダウンロード
3. ドラッグ&ドロップで順序調整
4. 解像度統一設定
5. 動画連結実行
6. 統合動画（MP4）出力

**期待結果**: 1つの連続した教育動画が完成

---

### **ユースケース2: 外国語動画の日本語音声化**
**シナリオ**: 英語YouTube動画を日本語ナレーション付き音声ファイルに変換

**処理フロー**:
1. YouTube URL入力
2. 動画から音声抽出
3. Whisper自動文字起こし（英語検出）
4. 日本語へ自動翻訳（5段階フォールバック）
5. edge_ttsで日本語音声合成
6. MP3ファイル出力

**期待結果**: オリジナルと同じタイミングの日本語音声ファイル

---

### **ユースケース3: ポッドキャスト音声の統合**
**シナリオ**: 複数のYouTube講義から音声だけを抽出し、1つのポッドキャストを作成

**処理フロー**:
1. 複数YouTube URLから音声抽出（MP3）
2. 各音声ファイルを音量正規化
3. ドラッグ&ドロップで順序調整
4. 音声ファイル連結
5. 統合MP3出力

**期待結果**: 1つの長編ポッドキャスト音声ファイル

---

## ✅ 機能要求（優先度順）

### **優先度1: YouTube動画ダウンロード** ⭐⭐⭐⭐⭐

#### **必須機能**
- [x] 単一URL入力・ダウンロード
- [x] 複数URL一括入力（改行区切り）
- [x] 動画情報表示
  - タイトル
  - 長さ（HH:MM:SS形式）
  - 解像度
  - サムネイル画像
- [x] 解像度選択
  - 480p
  - 720p (デフォルト)
  - 1080p
  - 最高画質
- [x] ダウンロード履歴表示（SQLite DB保存）
- [x] 進捗バー・推定残り時間表示
- [x] バッチ処理（複数動画同時処理）
- [x] 処理キュー管理
  - 追加/削除
  - 優先度変更
  - 一時停止/再開

#### **設定項目**
- デフォルト保存先: `./output/videos/`
- ファイル命名規則: YouTubeタイトル（サニタイズ済み）
- 同時ダウンロード数: 2-3（推奨）

#### **エラーハンドリング**
- ネットワークエラー: 自動リトライ（最大3回、5秒/10秒/30秒待機）
- 年齢制限動画: 警告表示
- 削除済み動画: スキップして次へ
- 無効URL: エラーメッセージ表示

---

### **優先度2: YouTube音声抽出（MP3）** ⭐⭐⭐⭐⭐

#### **必須機能**
- [x] YouTube動画から音声のみ抽出
- [x] MP3形式で保存
- [x] ビットレート選択
  - 128kbps (デフォルト)
  - 192kbps
  - 320kbps
- [x] ID3タグ自動設定
  - タイトル: YouTubeタイトル
  - アーティスト: チャンネル名
  - アルバム: "MediaForge Studio"
- [x] プレビュー機能（抽出前に試聴）

#### **処理フロー**
```
YouTube URL
  ↓
yt-dlp音声ダウンロード（bestaudio）
  ↓
FFmpeg MP3変換
  ↓
ID3タグ書き込み
  ↓
MP3保存 (./output/audios/)
```

---

### **優先度3: 音声吹き替え** ⭐⭐⭐⭐⭐

#### **処理フロー**
```
YouTube動画 or ローカル動画ファイル
  ↓
FFmpeg音声抽出（WAV）
  ↓
Whisper文字起こし（13言語自動検出）
  ↓
翻訳システム（5段階フォールバック）
  ├─ DeepL API（最高品質）
  ├─ Groq API（無料・高速）
  ├─ Gemini API（無料）
  ├─ OpenAI API（高品質）
  └─ Argos Translate（オフライン）
  ↓
TTS音声合成（選択可能）
  ├─ edge_tts（デフォルト・エンジン不要）
  ├─ VOICEVOX（高品質・エンジン必要）
  ├─ Google Cloud TTS（最高品質・API必要）
  └─ pyttsx3（オフライン・フォールバック）
  ↓
MP3出力 (./output/dubbed/)
```

#### **TTS設定要件**

**edge_tts（デフォルト）**
- エンジン起動: 不要
- 設定項目:
  - 話者選択（ドロップダウン）
    - ja-JP-NanamiNeural（女性・明るい）⭐推奨
    - ja-JP-KeitaNeural（男性・落ち着き）⭐推奨
    - ja-JP-ShioriNeural（女性・落ち着き）⭐推奨
    - その他10種類以上
  - スピード: 0.5～2.0（デフォルト: 1.0）
  - ピッチ: 0.8～1.2（デフォルト: 1.0）
  - 音量: 0.0～2.0（デフォルト: 1.0）

**VOICEVOX（オプション）**
- エンジン起動: 必要（http://localhost:50021）
- 設定項目:
  - 話者選択（リストボックス、全話者表示）
  - 感情選択（話者により異なる）
  - 速度: 0.5～2.0
  - ピッチ: -0.15～0.15
  - 抑揚: 0.0～2.0
  - 音量: 0.0～2.0

**Google Cloud TTS（オプション）**
- APIキー: 必要
- 設定項目:
  - 話者選択（Neural Voice）
  - スピード: 0.25～4.0
  - ピッチ: -20～20

#### **翻訳設定要件**
- 対応言語: 13言語（英語、韓国語、中国語簡体字・繁体字、スペイン語、フランス語、ドイツ語、ロシア語、ポルトガル語、ヘブライ語、アラビア語、ウクライナ語）
- デフォルト翻訳: Argos Translate（オフライン・無料）
- API設定時: 5段階フォールバック
- 翻訳先言語: 日本語固定
- 言語追加: 容易な設計（config.yaml編集）

#### **UI要件**
```
┌─ 音声吹き替え ─────────────────────┐
│ 入力: [YouTube URL or ファイル選択] │
│                                    │
│ TTS エンジン:                       │
│ ○ edge_tts (推奨)                  │
│   └ 話者: [Nanami ▼]               │
│   └ スピード: [━━●━━] 1.0          │
│                                    │
│ ○ VOICEVOX                         │
│   └ 話者: [ずんだもん ▼]            │
│   └ 感情: [ノーマル ▼]              │
│                                    │
│ 翻訳API: [auto（推奨） ▼]          │
│                                    │
│ [処理開始]                          │
└────────────────────────────────────┘
```

---

### **優先度4: 動画連結** ⭐⭐⭐⭐

#### **必須機能**
- [x] 複数動画ファイルを順番に連結
- [x] ドラッグ&ドロップで順序変更
- [x] 追加順をデフォルト
- [x] ファイルリスト表示（サムネイル付き）
- [x] 解像度統一処理
  - 最小解像度に統一
  - ユーザー指定解像度
  - 黒帯追加（アスペクト比維持）

#### **オプション機能（優先度低）**
- [ ] トランジション効果
  - なし（デフォルト）
  - フェードイン/アウト（0.5秒）
  - クロスディゾルブ（1秒）

#### **UI要件**
```
┌─ 動画連結 ─────────────────────────┐
│ [ファイル追加] [クリア]              │
│                                    │
│ ┌────────────────────────────────┐ │
│ │ 1. [📹] video1.mp4 [↑][↓][×]  │ │
│ │    720p - 00:05:32             │ │
│ │                                │ │
│ │ 2. [📹] video2.mp4 [↑][↓][×]  │ │
│ │    1080p - 00:03:15            │ │
│ │                                │ │
│ │ 3. [📹] video3.mp4 [↑][↓][×]  │ │
│ │    480p - 00:07:40             │ │
│ └────────────────────────────────┘ │
│                                    │
│ 出力解像度: [720p ▼]                │
│ トランジション: [なし ▼]            │
│                                    │
│ 合計長さ: 00:16:27                  │
│                                    │
│ [連結開始]                          │
└────────────────────────────────────┘
```

---

### **優先度5: 音声連結** ⭐⭐⭐⭐

#### **必須機能**
- [x] 複数MP3ファイルを連結
- [x] 音量自動正規化（ラウドネス標準化）
- [x] 自然な連結（無音挿入なし）
- [x] メタデータ統合
- [x] ドラッグ&ドロップで順序変更

#### **処理詳細**
```python
# pydub使用例
from pydub import AudioSegment
from pydub.effects import normalize

combined = AudioSegment.empty()

for audio_file in audio_files:
    audio = AudioSegment.from_mp3(audio_file)
    audio = normalize(audio)  # ラウドネス正規化
    combined += audio  # 無音なしで連結

combined.export("output.mp3", format="mp3", bitrate="128k")
```

#### **UI要件**
```
┌─ 音声連結 ─────────────────────────┐
│ [ファイル追加] [クリア]              │
│                                    │
│ ┌────────────────────────────────┐ │
│ │ 1. [🎵] audio1.mp3 [↑][↓][×]  │ │
│ │    128kbps - 00:05:32          │ │
│ │                                │ │
│ │ 2. [🎵] audio2.mp3 [↑][↓][×]  │ │
│ │    320kbps - 00:03:15          │ │
│ └────────────────────────────────┘ │
│                                    │
│ 音量正規化: [有効 ✓]                │
│ 出力ビットレート: [128kbps ▼]       │
│                                    │
│ 合計長さ: 00:08:47                  │
│                                    │
│ [連結開始]                          │
└────────────────────────────────────┘
```

---

### **優先度6: 見栄えの良いUI** ⭐⭐⭐

#### **デザイン要件**
- **フレームレスウィンドウ**: カスタムタイトルバー
- **Fluent Design**: QFluentWidgets使用
- **ダーク/ライトモード**: OS設定に自動追従
- **アニメーション**: スムーズな画面遷移
- **アクリル効果**: 半透明背景（オプション）
- **レスポンシブ**: ウィンドウサイズに応じた自動調整

#### **UI要素**
- タブナビゲーション（ダウンロード/音声抽出/吹替/連結）
- プログレスバー（円形・線形）
- カード型レイアウト
- ドラッグ&ドロップ対応エリア
- アイコン・イラスト豊富
- ツールチップヘルプ

#### **カラーパレット**
- **ライトモード**: 
  - プライマリ: #0078D4（Microsoft Blue）
  - 背景: #F3F3F3
  - テキスト: #000000
- **ダークモード**:
  - プライマリ: #60CDFF（Fluent Blue）
  - 背景: #202020
  - テキスト: #FFFFFF

---

## 🎨 UI/UX要求

### **メインウィンドウ構成**
```
┌──────────────────────────────────────────┐
│ 🎬 MediaForge Studio      [🔍][設定][×] │ ← カスタムタイトルバー
├──────────────────────────────────────────┤
│ [📥 DL] [🎵 音声] [🗣️ 吹替] [🔗 連結]  │ ← タブ
├──────────────────────────────────────────┤
│                                          │
│  ┌─ コンテンツエリア ─────────────────┐ │
│  │                                    │ │
│  │  （各タブの内容がここに表示）       │ │
│  │                                    │ │
│  └────────────────────────────────────┘ │
│                                          │
│  ■■■■■■□□□□ 65% (2分12秒残り)      │ ← プログレス
│                                          │
│  📋 処理キュー:                           │
│  ┌────────────────────────────────────┐ │
│  │ ✅ task1 - 完了                    │ │
│  │ ⏳ task2 - 処理中 45%              │ │
│  │ ⏸️ task3 - 待機中                  │ │
│  └────────────────────────────────────┘ │
│                                          │
│  [📁 出力フォルダを開く]                 │
└──────────────────────────────────────────┘
```

### **必須UI要素**
- [x] URL一括貼り付け（複数URL対応）
- [x] ダウンロード履歴表示（DB連携）
- [x] プレビュー機能（動画/音声）
- [x] プログレスバー・推定残り時間
- [x] ファイルのドラッグ&ドロップ
- [x] バッチ処理（複数同時処理）
- [x] 処理キュー管理（優先度変更可）
- [x] 設定のインポート/エクスポート

---

## 💾 データ・ファイル要求

### **出力形式**
- **動画**: MP4（デフォルト）、MKV、AVI（オプション）
- **音声**: MP3（デフォルト）、WAV（オプション）
- **ビットレート**: 128kbps（デフォルト）、192kbps、320kbps

### **保存先**
- デフォルト保存先: `./output/`
  - `videos/`: 動画ファイル
  - `audios/`: 音声ファイル
  - `dubbed/`: 吹き替え音声
- ユーザーによる変更可能

### **ファイル命名規則**
- デフォルト: YouTubeタイトル（サニタイズ済み）
  - 使用不可文字を除去: `\ / : * ? " < > |`
  - 最大長: 200文字
- カスタム命名: ユーザー指定可能
- 連番付与: `{title}_{index}.mp4`

---

## ⚙️ 技術要求

### **処理性能**
- **長時間動画対応**: 1時間以上の動画も処理可能
- **同時処理数**: 2-3並列（設定可能）
- **GPU使用**: 
  - Windows: CUDA自動検出
  - Mac: MPS（Apple Silicon）自動検出
  - フォールバック: CPU

### **エラーハンドリング**
- **ネットワークエラー**: 自動リトライ（最大3回）
- **処理失敗時**: 途中保存から再開可能
- **ログ出力**: 
  - `./logs/app_{date}.log`
  - `./logs/download_{date}.log`
  - `./logs/error_{date}.log`

### **データベース**
- **SQLite**: ダウンロード履歴、設定保存
- **テーブル構成**:
  - `download_history`: URL、タイトル、日時、ステータス
  - `app_settings`: 設定値
  - `queue_items`: 処理キュー

---

## 📦 配布要求

### **Phase 1: PyInstaller（安定版）**
- **形式**: onefolder
- **FFmpeg**: EXE同梱
- **VOICEVOX**: ユーザー手動インストール
- **配布**: ZIP圧縮

### **Phase 2: Nuitka（将来）**
- 実行速度向上
- ファイルサイズ削減

### **インストーラー（オプション）**
- NSIS or InnoSetup
- 自動更新機能（GitHub Releases連携）

---

## 🔒 制約事項

### **外部依存**
- **FFmpeg**: 必須（EXE同梱）
- **VOICEVOX Engine**: オプション（手動インストール）
- **インターネット**: 
  - YouTube DL: 必須
  - 翻訳API: オプション（オフラインフォールバックあり）
  - TTS: オプション（edge_tts/pyttsx3でオフライン可）

### **ライセンス**
- yt-dlp: Unlicense
- Whisper: MIT
- FFmpeg: LGPL/GPL
- QFluentWidgets: GPLv3（商用ライセンス別途）

---

## ✅ 受入基準

各機能が以下の基準を満たすこと：

### **YouTube動画ダウンロード**
- [ ] 単一URLから正常にダウンロードできる
- [ ] 複数URL（5個以上）を一括処理できる
- [ ] 進捗が正確に表示される
- [ ] エラー時に自動リトライされる
- [ ] 履歴がDB保存される

### **音声吹き替え**
- [ ] Whisperで13言語を認識できる
- [ ] 翻訳システムが正常に動作する
- [ ] edge_ttsで自然な日本語音声が生成される
- [ ] VOICEVOXが起動していれば選択できる
- [ ] 動画との結合なしで音声ファイルが出力される

### **連結機能**
- [ ] 動画を正しい順序で連結できる
- [ ] 音声を音量正規化して連結できる
- [ ] ドラッグ&ドロップで順序変更できる

### **UI/UX**
- [ ] フレームレスウィンドウが正常に動作する
- [ ] ダーク/ライトモードが切り替わる
- [ ] アニメーションがスムーズである
- [ ] すべてのウィジェットが正しく表示される

### **配布**
- [ ] PyInstallerでEXEが生成される
- [ ] 配布版が他のPCで正常に動作する
- [ ] FFmpegが同梱されている

---

## 📅 リリーススケジュール

- **Phase 1 (Week 1-3)**: コア機能実装
- **Phase 2 (Week 4-6)**: 音声処理・TTS統合
- **Phase 3 (Week 7-8)**: 連結機能・UI改善
- **Phase 4 (Week 9)**: 配布準備・テスト
- **Phase 5 (Week 10)**: 正式リリース

---

**作成日**: 2025-01-20  
**最終更新**: 2025-01-20  
**承認者**: [Your Name]
